name: gloo-enterprise
requiredValues:
  - Version
values:
  Namespace: gloo-system
resources:
  - helmChart:
      repoUrl: "https://storage.googleapis.com/gloo-ee-helm/"
      chartName: gloo-ee
      repoName: gloo-ee
      set:
        - "gloo.namespace.create=true"
        # NOTE: currently, grafana / prometheus are disabled because reapplying causes an error
        - "prometheus.enabled=false"
        - "grafana.defaultInstallationEnabled=false"
        - "gloo.gatewayProxies.gatewayProxyV2.readConfig=true"
      setEnv:
        license_key: LICENSE_KEY
  - secret:
      name: istio.default
      namespace: gloo-system
      entries:
        ca-cert.pem:
          file: registry/secrets/istio/ca-cert.pem
        ca-key.pem:
          file: registry/secrets/istio/ca-key.pem
        cert-chain.pem:
          file: registry/secrets/istio/cert-chain.pem
        root-cert.pem:
          file: registry/secrets/istio/root-cert.pem
    flags:
      - istio-ssl
  - application:
      path: registry/apps/gloo-app.yaml
      values:
        UpstreamName: gloo-system-apiserver-ui-8080
        UpstreamNamespace: "key:Namespace"
        VirtualServiceName: glooui
    flags:
      - gloo-app
  - patch:
      path: registry/patches/istio/gateway-proxy-deployment-ssl.yaml
      kubeType: deployment
      name: gateway-proxy-v2
      namespace: gloo-system
      patchType: strategic
    flags:
      - istio-ssl
  - patch:
      path: registry/patches/istio/gloo-service.yaml
      kubeType: service
      name: gateway-proxy-v2
      namespace: gloo-system
      patchType: strategic
    flags:
      - istio-ssl
      